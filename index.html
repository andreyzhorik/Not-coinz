<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Spin the Wheel — VIP Shared</title>
<style>
  body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background:#0f0f18;
    color:#fff;
    margin:0;
    display:flex;
    gap:20px;
    padding:20px;
    justify-content:center;
    align-items:flex-start;
  }

  /* Game column */
  .game {
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
    width:500px;
  }

  .wheel-container { position:relative; width:420px; height:420px; }
  #arrow {
    position:absolute; left:50%; top:-18px; transform:translateX(-50%);
    width:0; height:0;
    border-left:18px solid transparent;
    border-right:18px solid transparent;
    border-top:30px solid #e74c3c;
    z-index:10;
  }
  canvas{ width:100%; height:100%; border-radius:50%; border:8px solid #fff; background:transparent; }

  #userinfo { font-weight:700; font-size:18px; margin-top:6px; text-align:center; }

  #controls {
    background: rgba(255,255,255,0.03);
    padding:12px;
    border-radius:8px;
    display:flex;
    flex-direction:column;
    gap:10px;
    width:420px;
  }

  input[type="text"], input[type="number"], select, button {
    font-family: inherit;
    font-size:14px;
  }
  <script>
/* ---------------- WHEEL CONFIG ---------------- */
const outcomes = [
  "1.5x","0.5x","0.5x","1.1x","1.8x","10x","1.9x","Lose","Lose","1.7x",
  "Lose","1x","Lose","1x","Lose","Lose","1.4x","Lose","Lose","1.2x",
  "Lose","Lose","2.0x","5.0x","2.5x","1.3x","Lose","1.6x","0.5x","Lose",
  "2.5x","Lose","0.75x","Lose","2.0x","Lose"
];

function getColorForOutcome(outcome){
  if(outcome === "Lose" || outcome === "0.5x" || outcome === "0.75x") return "#e74c3c"; // red
  if(outcome === "5.0x" || outcome === "10x") return "#2ecc71"; // green
  return "#3498db"; // blue
}

/* ---------------- DRAW WHEEL ---------------- */
const cx = canvas.width/2, cy = canvas.height/2;
const radius = canvas.width/2 - 10;
const N = outcomes.length;
const sliceDeg = 360/N;
const RAD = Math.PI/180;
let rotationDeg = 0;

function drawWheel(rotDeg){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(cx,cy);
  ctx.rotate((rotDeg-90)*RAD);

  const slice = (2*Math.PI)/N;
  for(let i=0;i<N;i++){
    const angle = i*slice;
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0,0,radius,angle,angle+slice);
    ctx.closePath();
    ctx.fillStyle = getColorForOutcome(outcomes[i]);
    ctx.fill();
    ctx.strokeStyle="#111"; ctx.lineWidth=2; ctx.stroke();

    ctx.save();
    ctx.rotate(angle+slice/2);
    ctx.translate(radius*0.90,0);
    ctx.rotate(Math.PI/2);
    ctx.fillStyle="#fff";
    ctx.font="bold 14px Arial";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillText(outcomes[i],0,0);
    ctx.restore();
  }
  ctx.restore();
}
drawWheel(rotationDeg);

/* ---------------- HELPER ---------------- */
function updateUserInfoDisplay(){
  if(!username){ coinInfo.textContent="Not logged in"; coinInfo.style.color="#fff"; return; }
  let col="#fff";
  if(rank==="VIP") col="#f1f1a1"; // lighter yellow
  else if(rank==="VIP+") col="#f1c40f";
  else if(rank==="VIP++") col="#4819b6";
  coinInfo.textContent=`${username}: ${coins} | ${rank}`;
  coinInfo.style.color=col;
}

/* ---------------- LEADERBOARD ---------------- */
const leaderboardList = document.getElementById('leaderboardList');

async function fetchLeaderboard(){
  try{
    const res = await fetch(API_URL);
    leaderboardData = await res.json();
    renderLeaderboard();
  }catch(e){ console.error(e); }
}

function renderLeaderboard(){
  leaderboardList.innerHTML="";
  leaderboardData.sort((a,b)=>b.coins - a.coins);
  leaderboardData.forEach((p,i)=>{
    const li=document.createElement('li');
    let col="#fff";
    if(p.rank==="VIP") col="#f1f1a1";
    else if(p.rank==="VIP+") col="#f1c40f";
    else if(p.rank==="VIP++") col="#4819b6";
    li.style.color=col;
    li.textContent=`${i+1}. ${p.name}: ${p.coins} | ${p.rank}`;
    leaderboardList.appendChild(li);
  });
}

/* ---------------- USER LOGIN ---------------- */
setUsernameBtn.addEventListener('click', async ()=>{
  const val=usernameInput.value.trim();
  if(!val){ alert("Enter a username"); return; }
  username=val;
  usernameInput.disabled=true;
  setUsernameBtn.disabled=true;

  // fetch from API or create
  try{
    const res=await fetch(`${API_URL}?name=${username}`);
    const data=await res.json();
    if(data.length>0){
      coins=Number(data[0].coins)||100;
      rank=data[0].rank||"None";
    } else {
      coins=100; rank="None";
      await fetch(API_URL,{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({name:username,coins,rank})});
    }
    updateUserInfoDisplay();
    fetchLeaderboard();
  }catch(e){ console.error(e); }
});

/* ---------------- SPIN LOGIC ---------------- */
let spinning=false;
spinBtn.addEventListener('click', async ()=>{
  if(!username){ alert("Set username first"); return; }
  if(spinning) return;

  let bet=Math.floor(Number(document.getElementById('bet').value)||0);
  if(bet<=0){ alert("Enter a valid bet"); return; }
  if(bet>coins){ alert("Not enough coins"); return; }

  coins=Math.max(0, coins-bet);
  updateUserInfoDisplay();

  spinning=true;
  const idx=Math.floor(Math.random()*N);
  const result=outcomes[idx];

  const currentNorm=((rotationDeg%360)+360)%360;
  const sliceCenterDeg=idx*sliceDeg+sliceDeg/2;
  const baseRotationDeg=(360-sliceCenterDeg)%360;
  const delta=(baseRotationDeg-currentNorm+360)%360;
  const fullSpins=6+Math.floor(Math.random()*5);
  const targetRotation=rotationDeg+fullSpins*360+delta;

  const start=rotationDeg;
  const duration=4200;
  const t0=performance.now();

  function step(t){
    const elapsed=t-t0;
    const p=Math.min(elapsed/duration,1);
    const ease=1-Math.pow(1-p,3);
    rotationDeg=start+(targetRotation-start)*ease;
    drawWheel(rotationDeg);
    if(p<1) requestAnimationFrame(step);
    else {
      rotationDeg=baseRotationDeg+360*Math.floor(rotationDeg/360);
      let win=0;
      if(result!=="Lose"){ win=Math.floor(bet*parseFloat(result)); alert(`🎉 Won ${win} coins! (${result})`); }
      else alert("😢 You lost your bet!");
      coins=Math.max(0, coins+win);
      if(coins===0) coins=100;
      updateUserInfoDisplay();

      // update API
      const existing=leaderboardData.find(p=>p.name===username);
      if(existing){
        fetch(`${API_URL}/${existing.id}`,{method:"PUT", headers:{"Content-Type":"application/json"}, body:JSON.stringify({coins,rank})});
      }
      spinning=false;
      fetchLeaderboard();
    }
  }
  requestAnimationFrame(step);
});

/* ---------------- ADMIN PANEL ---------------- */
adminBtn.addEventListener('click', ()=>{
  if(adminPass.value===ADMIN_PASSWORD){
    adminControls.style.display='flex';
    adminPass.value='';
    adminCoinsInput.value=coins;
    adminRankSelect.value=rank;
  } else alert("Incorrect password");
});

setCoinsBtn.addEventListener('click', async ()=>{
  const v=Math.max(0,Math.floor(Number(adminCoinsInput.value)||0));
  coins=v;
  updateUserInfoDisplay();
  // update API
  const existing=leaderboardData.find(p=>p.name===username);
  if(existing) await fetch(`${API_URL}/${existing.id}`,{method:"PUT", headers:{"Content-Type":"application/json"}, body:JSON.stringify({coins,rank})});
  fetchLeaderboard();
});

setRankBtn.addEventListener('click', async ()=>{
  rank=adminRankSelect.value||"None";
  updateUserInfoDisplay();
  const existing=leaderboardData.find(p=>p.name===username);
  if(existing) await fetch(`${API_URL}/${existing.id}`,{method:"PUT", headers:{"Content-Type":"application/json"}, body:JSON.stringify({coins,rank})});
  fetchLeaderboard();
});

resetLeaderboardBtn.addEventListener('click', async ()=>{
  if(!confirm("Reset leaderboard on server?")) return;
  for(const p of leaderboardData){
    await fetch(`${API_URL}/${p.id}`,{method:"DELETE"});
  }
  fetchLeaderboard();
});

hideAdminBtn.addEventListener('click', ()=>{ adminControls.style.display='none'; });

/* ---------------- INIT ---------------- */
fetchLeaderboard();
updateUserInfoDisplay();
</script>

  #username { padding:8px; width:180px; text-align:center; border-radius:6px; border:1px solid #333; background:transparent; color:#fff; }
  #setUsername { padding:8px 12px; border-radius:6px; cursor:pointer; background:#2d8aee; color:white; border:none; }

  #bet { padding:8px; width:120px; text-align:center; border-radius:6px; border:1px solid #333; background:transparent; color:#fff; }
  #spin { padding:10px 18px; background:#28a745; border-radius:8px; color:white; border:none; cursor:pointer; font-weight:700; }
  #spin:disabled { opacity:0.5; cursor:not-allowed; }

  /* Admin panel */
  #adminPanel { margin-top:10px; width:100%; background: rgba(0,0,0,0.25); padding:10px; border-radius:8px; color:#fff; }
  #adminPanel input[type=password] { padding:6px; width:140px; border-radius:6px; background:transparent; border:1px solid #333; color:#fff; }
  .admin-controls { margin-top:8px; display:none; gap:8px; flex-direction:column; }
  .admin-controls input[type=number], .admin-controls select { padding:6px; width:120px; }
  .admin-controls button { padding:8px 10px; border-radius:6px; border:none; cursor:pointer; }

  /* Leaderboard */
  .side { width:260px; background: rgba(255,255,255,0.03); padding:12px; border-radius:8px; }
  .side h2 { margin:0 0 8px 0; }
  #leaderboardList { list-style:none; padding-left:0; margin:0; max-height:520px; overflow:auto; }
  #leaderboardList li { padding:6px 6px; border-bottom:1px solid rgba(255,255,255,0.03); font-weight:600; }

</style>
</head>
<body>

<div class="game">
  <h1>🎡 Spin the Wheel</h1>

  <div class="wheel-container">
    <div id="arrow"></div>
    <canvas id="wheel" width="420" height="420"></canvas>
  </div>

  <div id="userinfo">Not logged in</div>

  <div id="controls">
    <div>
      <input id="username" type="text" placeholder="Enter username (once)">
      <button id="setUsername">Set Username</button>
    </div>
    <div>
      <label>Bet:</label>
      <input id="bet" type="number" min="1" value="10">
      <button id="spin">SPIN</button>
    </div>

    <div id="adminPanel">
      <div>
        <label>Admin pass:</label>
        <input id="adminPass" type="password" placeholder="Password">
        <button id="adminBtn">Enter</button>
      </div>
      <div class="admin-controls" id="adminControls">
        <div>
          <label>Set coins:</label>
          <input id="adminCoins" type="number" min="0" value="100">
          <button id="setCoinsBtn">Set</button>
        </div>
        <div>
          <label>Set rank:</label>
          <select id="adminRank">
            <option value="None">None</option>
            <option value="VIP">VIP</option>
            <option value="VIP+">VIP+</option>
            <option value="VIP++">VIP++</option>
          </select>
          <button id="setRankBtn">Set Rank</button>
        </div>
        <div>
          <button id="resetLeaderboardBtn" style="background:#e74c3c;color:white;">Reset Leaderboard</button>
          <button id="hideAdminBtn">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="side">
  <h2>🏆 Leaderboard</h2>
  <ul id="leaderboardList"></ul>
</div>

<script>
/* ---------------- CONFIG ---------------- */
const API_URL = "https://68e839b2f2707e6128ca35e1.mockapi.io/players";
const ADMIN_PASSWORD = "ghd87";
let username = "";
let coins = 100;
let rank = "None";
let leaderboardData = [];

/* ---------------- DOM ---------------- */
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const spinBtn = document.getElementById('spin');
const setUsernameBtn = document.getElementById('setUsername');
const usernameInput = document.getElementById('username');
const coinInfo = document.getElementById('userinfo');

const adminPass = document.getElementById('adminPass');
const adminBtn = document.getElementById('adminBtn');
const adminControls = document.getElementById('adminControls');
const adminCoinsInput = document.getElementById('adminCoins');
const setCoinsBtn = document.getElementById('setCoinsBtn');
const adminRankSelect = document.getElementById('adminRank');
const setRankBtn = document.getElementById('setRankBtn');
const resetLeaderboardBtn = document.getElementById('resetLeaderboardBtn');
const hideAdminBtn = document.getElementById('hideAdminBtn');
</script>
