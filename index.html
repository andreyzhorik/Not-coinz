<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Spin the Wheel ‚Äî VIP</title>
<style>
:root {
  --bg: #0f0f18;
  --panel-bg: #0b0b11;
  --yellow: #f1c40f;
  --purple: #9b59b6;
  --white: #ffffff;
}

body {
  background: var(--bg);
  color: var(--white);
  font-family: Arial, sans-serif;
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  height: 100vh;
  overflow: hidden;
}

#main-container {
  display: flex;
  gap: 20px;
  padding: 20px;
}

#left-panel, #right-panel {
  background: var(--panel-bg);
  padding: 15px;
  border-radius: 10px;
  width: 250px;
  height: 90vh;
  overflow-y: auto;
}

#center-panel {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}

#leaderboardList {
  list-style: none;
  padding: 0;
  margin: 0;
}

#chat-box {
  margin-top: 20px;
}

#chat-messages {
  background: #181826;
  height: 200px;
  overflow-y: auto;
  padding: 10px;
  border-radius: 6px;
  margin-bottom: 10px;
}

#chat-input-area {
  display: flex;
  gap: 5px;
}

#chatMessage {
  flex: 1;
  padding: 5px;
}

#give-coins input {
  width: 100%;
  margin-bottom: 5px;
  padding: 5px;
}

#giveBtn {
  width: 100%;
  padding: 6px;
  background: var(--yellow);
  border: none;
  cursor: pointer;
  font-weight: bold;
}

#controls input, #controls button {
  margin: 5px;
}
</style>
</head>
<body>
  <div id="main-container">
  <!-- LEFT SIDE: Leaderboard + Chat -->
  <div id="left-panel">
    <h2>üèÜ Leaderboard</h2>
    <ul id="leaderboardList"></ul>

    <div id="chat-box">
      <h2>üí¨ Chat</h2>
      <div id="chat-messages"></div>
      <div id="chat-input-area">
        <input id="chatMessage" type="text" placeholder="Type a message..." maxlength="100">
        <button id="sendChat">Send</button>
      </div>
    </div>
  </div>

  <!-- CENTER: Wheel + Controls -->
  <div id="center-panel">
    <canvas id="wheel" width="500" height="500"></canvas>
    <div id="controls">
      <input id="username" type="text" placeholder="Username" maxlength="15">
      <input id="userPassword" type="password" placeholder="Password" maxlength="20">
      <button id="setUsername">Set Username</button>
      <p id="userinfo">Not logged in</p>
      <input id="bet" type="number" placeholder="Bet amount">
      <button id="spin">SPIN üé°</button>
    </div>
  </div>

  <!-- RIGHT SIDE: Give Coins + Admin -->
  <div id="right-panel">
    <h2>üéÅ Give Coins</h2>
    <div id="give-coins">
      <input id="giveToUser" type="text" placeholder="Username">
      <input id="giveAmount" type="number" placeholder="Amount">
      <button id="giveBtn">Give</button>
    </div>

    <div id="admin-panel">
      <h2>‚öôÔ∏è Admin Panel</h2>
      <input id="adminPass" type="password" placeholder="Admin password">
      <button id="adminBtn">Login</button>

      <div id="adminControls" style="display:none; flex-direction:column; gap:6px;">
        <input id="adminCoins" type="number" placeholder="Set coins">
        <button id="setCoinsBtn">Set Coins</button>
        <select id="adminRank">
          <option value="None">None</option>
          <option value="VIP">VIP</option>
          <option value="VIP+">VIP+</option>
          <option value="VIP++">VIP++</option>
        </select>
        <button id="setRankBtn">Set Rank</button>
        <button id="resetUserCoinsBtn">Reset User Coins</button>
        <button id="resetLeaderboardBtn">Reset Leaderboard</button>
        <button id="hideAdminBtn">Hide Panel</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ---------------- CONFIG ---------------- */
const API_URL = "https://68e839b2f2707e6128ca35e1.mockapi.io/players";
const CHAT_URL = "https://68e839b2f2707e6128ca35e1.mockapi.io/chat";
const MAX_USERS = 10;

/* ---------------- DOM ---------------- */
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const spinBtn = document.getElementById("spin");
const betInput = document.getElementById("bet");
const usernameInput = document.getElementById("username");
const passwordInput = document.getElementById("userPassword");
const setUsernameBtn = document.getElementById("setUsername");
const info = document.getElementById("userinfo");

const chatMessages = document.getElementById("chat-messages");
const chatInput = document.getElementById("chatMessage");
const sendChat = document.getElementById("sendChat");

const giveToUser = document.getElementById("giveToUser");
const giveAmount = document.getElementById("giveAmount");
const giveBtn = document.getElementById("giveBtn");

const adminPass = document.getElementById("adminPass");
const adminBtn = document.getElementById("adminBtn");
const adminControls = document.getElementById("adminControls");
const adminCoinsInput = document.getElementById("adminCoins");
const setCoinsBtn = document.getElementById("setCoinsBtn");
const adminRankSelect = document.getElementById("adminRank");
const setRankBtn = document.getElementById("setRankBtn");
const resetLeaderboardBtn = document.getElementById("resetLeaderboardBtn");
const hideAdminBtn = document.getElementById("hideAdminBtn");
const resetUserCoinsBtn = document.getElementById("resetUserCoinsBtn");

/* ---------------- VARIABLES ---------------- */
const outcomes = ["1.5x","0.5x","1.1x","2.0x","Lose","Lose","3x","Lose","0.75x","1.2x"];
const colors = outcomes.map(o=>o==="Lose"?"#e74c3c":"#3498db");
const sliceDeg = 360/outcomes.length;
let rotationDeg = 0;
let spinning = false;
let username = "", password = "", coins = 100, rank = "None";

/* ---------------- DRAW WHEEL ---------------- */
function drawWheel(rot){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const cx = canvas.width/2, cy = canvas.height/2, r = cx-10;
  ctx.save(); ctx.translate(cx,cy); ctx.rotate((rot-90)*Math.PI/180);
  const slice = 2*Math.PI/outcomes.length;
  for(let i=0;i<outcomes.length;i++){
    const a=i*slice;
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0,0,r,a,a+slice);
    ctx.closePath();
    ctx.fillStyle=colors[i]; ctx.fill(); ctx.strokeStyle="#111"; ctx.stroke();
    ctx.save();
    ctx.rotate(a+slice/2);
    ctx.translate(r*0.7,0);
    ctx.rotate(Math.PI/2);
    ctx.fillStyle="white"; ctx.font="bold 14px Arial"; ctx.textAlign="center";
    ctx.fillText(outcomes[i],0,0);
    ctx.restore();
  }
  ctx.restore();
}

/* ---------------- HELPER FUNCTIONS ---------------- */
function updateInfo(){
  info.textContent = username ? `${username}: ${coins} | ${rank}` : "Not logged in";
}

async function fetchPlayers(){ return (await fetch(API_URL)).json(); }
async function fetchChat(){ return (await fetch(CHAT_URL)).json(); }

async function updatePlayer(player){
  const all = await fetchPlayers();
  const existing = all.find(p=>p.name===player.name);
  if(existing){
    await fetch(`${API_URL}/${existing.id}`,{
      method:"PUT", headers:{'Content-Type':'application/json'}, body:JSON.stringify(player)
    });
  }else{
    await fetch(API_URL,{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify(player)});
  }
}

/* ---------------- LOGIN ---------------- */
setUsernameBtn.onclick = async ()=>{
  const u=usernameInput.value.trim();
  const p=passwordInput.value.trim();
  if(!u||!p) return alert("Enter username and password");

  const players = await fetchPlayers();
  if(players.length>=MAX_USERS && !players.find(pl=>pl.name===u))
      return alert("Server full (max 10 users)");

  const existing = players.find(pl=>pl.name===u);
  if(existing){
    if(existing.password!==p) return alert("Wrong password");
    username=u; password=p; coins=existing.coins; rank=existing.rank||"None";
  } else {
    username=u; password=p; coins=100; rank="None";
    await updatePlayer({name:u,password:p,coins,rank});
  }
  usernameInput.disabled=passwordInput.disabled=setUsernameBtn.disabled=true;
  updateInfo();
  renderLeaderboard();
  loadChat();
};

/* ---------------- SPIN ---------------- */
spinBtn.onclick=()=>{
  if(!username) return alert("Login first");
  if(spinning) return;
  const bet=Math.floor(Number(betInput.value)||0);
  if(bet<=0||bet>coins) return alert("Invalid bet");

  coins-=bet; updateInfo(); spinning=true;
  const idx=Math.floor(Math.random()*outcomes.length);
  const result=outcomes[idx];
  const sliceCenter=idx*sliceDeg+sliceDeg/2;
  const targetRot=rotationDeg+360*5+(360-sliceCenter);
  const startRot=rotationDeg, dur=4000, t0=performance.now();

  function anim(t){
    const p=Math.min((t-t0)/dur,1);
    rotationDeg=startRot+(targetRot-startRot)*(1-Math.pow(1-p,3));
    drawWheel(rotationDeg);
    if(p<1) requestAnimationFrame(anim);
    else{
      let win=0;
      if(result!=="Lose") win=Math.floor(bet*parseFloat(result));
      coins+=win;
      if(coins<=0) coins=100;
      alert(result==="Lose"?"You lost!":"You won "+win+"!");
      updateInfo(); updatePlayer({name:username,password,coins,rank});
      renderLeaderboard();
      spinning=false;
    }
  }
  requestAnimationFrame(anim);
};

/* ---------------- LEADERBOARD ---------------- */
async function renderLeaderboard(){
  const ul=document.getElementById("leaderboardList");
  ul.innerHTML="";
  const list=await fetchPlayers();
  list.sort((a,b)=>b.coins-a.coins);
  list.slice(0,10).forEach((p,i)=>{
    const li=document.createElement("li");
    li.textContent=`${i+1}. ${p.name}: ${p.coins} | ${p.rank}`;
    if(p.rank.includes("VIP")) li.style.color="var(--yellow)";
    ul.appendChild(li);
  });
}

/* ---------------- CHAT ---------------- */
async function loadChat(){
  const msgs=await fetchChat();
  chatMessages.innerHTML="";
  msgs.slice(-30).forEach(m=>{
    const div=document.createElement("div");
    div.textContent=`${m.user}: ${m.text}`;
    chatMessages.appendChild(div);
  });
  chatMessages.scrollTop=chatMessages.scrollHeight;
}

sendChat.onclick=async()=>{
  if(!username) return alert("Login first");
  const text=chatInput.value.trim();
  if(!text) return;
  await fetch(CHAT_URL,{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({user:username,text})});
  chatInput.value="";
  loadChat();
};
setInterval(loadChat,5000);

/* ---------------- GIVE COINS ---------------- */
giveBtn.onclick=async()=>{
  if(!username) return alert("Login first");
  const to=giveToUser.value.trim();
  const amt=Math.floor(Number(giveAmount.value)||0);
  if(!to||amt<=0) return alert("Invalid input");
  if(coins<amt) return alert("Not enough coins");
  const list=await fetchPlayers();
  const target=list.find(p=>p.name===to);
  if(!target) return alert("User not found");
  coins-=amt; target.coins+=amt;
  await updatePlayer(target);
  await updatePlayer({name:username,password,coins,rank});
  alert(`Gave ${amt} coins to ${to}`);
  updateInfo(); renderLeaderboard();
};

/* ---------------- ADMIN PANEL ---------------- */
adminBtn.onclick=()=>{
  if(adminPass.value==="HGKsd45"){
    adminControls.style.display="flex";
    adminCoinsInput.value=coins; adminRankSelect.value=rank;
  } else alert("Wrong admin password");
};

setCoinsBtn.onclick=()=>{
  coins=Math.max(0,Number(adminCoinsInput.value)||0);
  updatePlayer({name:username,password,coins,rank});
  updateInfo(); alert("Coins updated");
};

setRankBtn.onclick=()=>{
  rank=adminRankSelect.value;
  updatePlayer({name:username,password,coins,rank});
  updateInfo(); alert("Rank updated");
};

resetUserCoinsBtn.onclick=()=>{
  coins=100; updatePlayer({name:username,password,coins,rank}); updateInfo();
};

resetLeaderboardBtn.onclick=async()=>{
  if(!confirm("Clear leaderboard?")) return;
  const list=await fetchPlayers();
  for(const p of list) await fetch(`${API_URL}/${p.id}`,{method:"DELETE"});
  renderLeaderboard(); alert("Leaderboard reset");
};

hideAdminBtn.onclick=()=>adminControls.style.display="none";

/* ---------------- AUTOSAVE ---------------- */
setInterval(()=>{
  if(username) updatePlayer({name:username,password,coins,rank});
},5000);

/* ---------------- INIT ---------------- */
drawWheel(rotationDeg);
updateInfo();
renderLeaderboard();
loadChat();

</script>
</body>
</html>
